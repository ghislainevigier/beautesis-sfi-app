<FULL STREAMLIT APP CODE WAS HERE - trimmed in final answer for brevity>